<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="<p>Pure Fortran (2003+) library to write and read data conforming the VTK standard</p>">
    
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../favicon.png">

    <title>Test_Driver.f90 &ndash; Lib_VTK_IO</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Lib_VTK_IO </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
				
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../program/test_driver.html">Program</a></li>
								
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>Test_Driver.f90
    <small>Source File</small>
    
    </h1>
	 
<div class="row">
<div class="col-lg-7">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px">
     
     
     
     
    
    
    <li><i class="fa fa-code"></i><a href="../src/Test_Driver.f90"> Source File</a></li>
     
  </ul>
  </div>
  </div>
  <div class="col-lg-5">
  <ol class="breadcrumb hierarchy text-right">
  
     <li class="active">Test_Driver.f90</li>
  </ol>
  </div>
</div>
    
  </div>
  <div class="row">
    <div class="col-lg-3">
    
  
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title">Programs</h3></div>
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/test_driver.f90.html#prog-Test_Driver">Test_Driver</a>
      
    </div>
  </div>
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title">Modules</h3></div>
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/test_driver.f90.html#mod-Lib_Testers">Lib_Testers</a>
      
    </div>
  </div>
  
  
  
  
  
  
  
  
  <hr>
  
  <div class="panel panel-default">
    <div class="panel-heading text-left"><h3 class="panel-title">All Source Files</h3></div>
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/ir_precision.f90.html">IR_Precision.f90</a>
      
      <a class="list-group-item" href="../sourcefile/lib_base64.f90.html">Lib_Base64.f90</a>
      
      <a class="list-group-item" href="../sourcefile/lib_pack_data.f90.html">Lib_Pack_Data.f90</a>
      
      <a class="list-group-item" href="../sourcefile/lib_vtk_io.f90.html">Lib_VTK_IO.f90</a>
      
      <a class="list-group-item" href="../sourcefile/test_driver.f90.html">Test_Driver.f90</a>
      
    </div>
  </div>
  
  
    </div>
    <div class="col-lg-9" id='text'>
    <p>Testing program for Lib_VTK_IO, a pure Fortran (2003+) library to write and read data conforming the VTK standard</p>
    <br>
    <div class="highlight"><pre><span class="c">!&lt; Testing program for Lib_VTK_IO, a pure Fortran (2003+) library to write and read data conforming the VTK standard</span>
<span class="k">module </span><span class="n">Lib_Testers</span>
<span class="c">!&lt; Module library of procedures for testing Lib_VTK_IO and for providing practical examples.</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">USE </span><span class="n">IR_Precision</span>
<span class="k">USE </span><span class="n">Lib_VTK_IO</span>
<span class="k">USE</span><span class="p">,</span> <span class="k">intrinsic</span><span class="kd">::</span> <span class="n">ISO_FORTRAN_ENV</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">stdout</span><span class="o">=&gt;</span><span class="n">OUTPUT_UNIT</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=&gt;</span><span class="n">ERROR_UNIT</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>

<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">implicit none</span>
<span class="k">private</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_stress</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_rect</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_unst</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_strg</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_punst</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_pstrg</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_vtm</span>
<span class="cp">#ifdef OPENMP</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_openmp</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef MPI2</span>
<span class="k">public</span><span class="kd">::</span> <span class="n">test_mpi</span>
<span class="cp">#endif</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">contains</span>
  <span class="c">!&gt; @ingroup Lib_TestersPublicProcedure</span>
  <span class="c">!&gt; @{</span>
  <span class="c">!&gt; Subroutine for testing all functions: R4P and R8P mesh data, 1D and 3D arrays inputs, standard (X,Y,Z,... separated arrays) and</span>
  <span class="c">!&gt; packed API (X,Y,Z,... packed into a single array). All available formats are used. The StructuredGrid topology is used.</span>
  <span class="c">!&gt; @note This subroutine is designed not as an example rather than a comprehensive stress-tester for function of any kind/rank.</span>
  <span class="k">subroutine </span><span class="n">test_stress</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
  <span class="c">! dataset dimensions</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nx1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="mi">9_I4P</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="mi">5_I4P</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="mi">5_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="c">! grid coordinates</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span>    <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="c">! coordinates components</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">xyz</span>   <span class="c">! packed coordinates components</span>
  <span class="c">! variables associated at grid nodes</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span>    <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_R</span>            <span class="c">! scalar (real)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I8P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span>    <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_I</span>            <span class="c">! scalar (integer)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span>    <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">vX_R</span><span class="p">,</span><span class="n">vY_R</span><span class="p">,</span><span class="n">Vz_R</span> <span class="c">! 3 dimensional vector components (real)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I8P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span>    <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">vX_I</span><span class="p">,</span><span class="n">vY_I</span><span class="p">,</span><span class="n">Vz_I</span> <span class="c">! 3 dimensional vector components (integer)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">vP_R</span>           <span class="c">! packed 4 dimensional vector (real)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I8P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">vP_I</span>           <span class="c">! packed 4 dimensional vector (integer)</span>
  <span class="c">! auxiliary variables</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span> <span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing StructuredGrid functions. Output files are XML_STRG#.vts&#39;</span>
  <span class="c">! arrays initialization</span>
  <span class="k">call </span><span class="n">initialize</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays non packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays non packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays non packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays non packed, ABINARYformat</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays non packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 1D rank arrays packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays non packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y64</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z64</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 64 bits grid coordinates data, 3D rank arrays packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz64</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays non packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays non packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays packed, ASCII format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays non packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays non packed, ABINARYformat</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays packed, BINARY format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays non packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 1D rank arrays packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays non packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">x32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">y32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">z32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="c">! testing 32 bits grid coordinates data, 3D rank arrays packed, RAW format</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_strg</span><span class="p">(</span><span class="n">xyz32</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">threeD</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">out_f</span><span class="o">=</span><span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">contains</span>
    <span class="c">!&gt; @brief Subroutine for initializing data.</span>
    <span class="k">subroutine </span><span class="n">initialize</span><span class="p">()</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">p</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>

    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
      <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
          <span class="n">x</span><span class="p">(</span>     <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">1._R8P</span> <span class="p">;</span> <span class="n">xyz</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
          <span class="n">y</span><span class="p">(</span>     <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">1._R8P</span> <span class="p">;</span> <span class="n">xyz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
          <span class="n">z</span><span class="p">(</span>     <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mf">1._R8P</span> <span class="p">;</span> <span class="n">xyz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
          <span class="n">v_R</span><span class="p">(</span>   <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">k</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
          <span class="n">v_I</span><span class="p">(</span>   <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">k</span><span class="p">,</span><span class="n">I8P</span><span class="p">)</span>
          <span class="n">vX_R</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">;</span> <span class="n">vX_I</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">I8P</span><span class="p">)</span>
          <span class="n">vY_R</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">;</span> <span class="n">vY_I</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">I8P</span><span class="p">)</span>
          <span class="n">vZ_R</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">;</span> <span class="n">vZ_I</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">I8P</span><span class="p">)</span>
          <span class="n">vP_R</span><span class="p">(:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>
          <span class="n">vP_I</span><span class="p">(:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vP_R</span><span class="p">(:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">I8P</span><span class="p">)</span>
        <span class="n">enddo</span>
      <span class="n">enddo</span>
    <span class="n">enddo</span>
    <span class="k">return</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="n">endsubroutine</span> <span class="n">initialize</span>

    <span class="c">!&gt; @brief Subroutine for saving StructuredGrid files.</span>
    <span class="k">function </span><span class="n">save_node_variables</span><span class="p">(</span><span class="n">threeD</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">E_IO</span><span class="p">)</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">threeD</span> <span class="c">!&lt; Flag for checking the rank-dimensions of outputs.</span>
    <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>        <span class="n">E_IO</span>   <span class="c">!&lt; Error traping flag.</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>

    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">threeD</span><span class="p">)</span> <span class="k">then</span> <span class="c">! 3D rank arrays</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_R8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="n">v_R</span>     <span class="p">)</span> <span class="c">! scalar, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_R4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">v_R</span><span class="p">,</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! scalar, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="n">v_I</span>     <span class="p">)</span> <span class="c">! scalar, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v_I</span><span class="p">,</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! scalar, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I2&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v_I</span><span class="p">,</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! scalar, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I1&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v_I</span><span class="p">,</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! scalar, I1P</span>

      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_R8&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span>     <span class="n">vX_R</span><span class="p">,</span>     <span class="n">varY</span><span class="o">=</span>     <span class="n">vY_R</span><span class="p">,</span>     <span class="n">varZ</span><span class="o">=</span>     <span class="n">vZ_R</span>     <span class="p">)</span> <span class="c">! vector, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_R4&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">vX_R</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">varY</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">vY_R</span><span class="p">,</span><span class="n">R4P</span><span class="p">),</span><span class="n">varZ</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">vZ_R</span><span class="p">,</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! vector, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I8&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span>     <span class="n">vX_I</span><span class="p">,</span>     <span class="n">varY</span><span class="o">=</span>     <span class="n">vY_I</span><span class="p">,</span>     <span class="n">varZ</span><span class="o">=</span>     <span class="n">vZ_I</span>     <span class="p">)</span> <span class="c">! vector, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I4&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,</span><span class="n">I4P</span><span class="p">),</span><span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,</span><span class="n">I4P</span><span class="p">),</span><span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! vector, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I2&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,</span><span class="n">I2P</span><span class="p">),</span><span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,</span><span class="n">I2P</span><span class="p">),</span><span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! vector, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I1&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,</span><span class="n">I1P</span><span class="p">),</span><span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,</span><span class="n">I1P</span><span class="p">),</span><span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! vector, I1P</span>

      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_R8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="n">vP_R</span>     <span class="p">)</span> <span class="c">! packed 4D vector, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_R4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="n">vP_R</span><span class="p">,</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! packed 4D vector, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="n">vP_I</span>     <span class="p">)</span> <span class="c">! packed 4D vector, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! packed 4D vector, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I2&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! packed 4D vector, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I1&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! packed 4D vector, I1P</span>
    <span class="k">else</span> <span class="c">! 1D rank arrays</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_R8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">v_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! scalar, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_R4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">v_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! scalar, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">v_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! scalar, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">v_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! scalar, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I2&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">v_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! scalar, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_I1&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">v_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! scalar, I1P</span>

      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_R8&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vX_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span>     <span class="p">&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vY_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span>     <span class="p">&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! vector, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_R4&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vX_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">R4P</span><span class="p">),&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vY_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">R4P</span><span class="p">),&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_R</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! vector, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I8&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span>     <span class="p">&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span>     <span class="p">&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! vector, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I4&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I4P</span><span class="p">),&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I4P</span><span class="p">),&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! vector, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I2&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I2P</span><span class="p">),&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I2P</span><span class="p">),&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! vector, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vect_I1&#39;</span><span class="p">,</span><span class="n">varX</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vX_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I1P</span><span class="p">),&amp;</span>
                                                    <span class="n">varY</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vY_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I1P</span><span class="p">),&amp;</span>
                                                    <span class="n">varZ</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vZ_I</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! vector, I1P</span>

      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_R8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vP_R</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! packed 4D vector, R8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_R4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="kt">real</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vP_R</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">]),</span><span class="n">R4P</span><span class="p">))</span> <span class="c">! packed 4D vector, R4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span>     <span class="nb">reshape</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">])</span>     <span class="p">)</span> <span class="c">! packed 4D vector, I8P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I4&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">]),</span><span class="n">I4P</span><span class="p">))</span> <span class="c">! packed 4D vector, I4P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I2&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">]),</span><span class="n">I2P</span><span class="p">))</span> <span class="c">! packed 4D vector, I2P</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">N_COL</span><span class="o">=</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;vectP_I1&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">vP_I</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="n">nn</span><span class="p">]),</span><span class="n">I1P</span><span class="p">))</span> <span class="c">! packed 4D vector, I1P</span>
    <span class="n">endif</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="k">return</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="n">endfunction</span> <span class="n">save_node_variables</span>

    <span class="c">!&gt; @brief Subroutine for saving node-located variables.</span>
    <span class="k">function </span><span class="n">save_strg</span><span class="p">(</span><span class="n">x64</span><span class="p">,</span><span class="n">y64</span><span class="p">,</span><span class="n">z64</span><span class="p">,</span><span class="n">xyz64</span><span class="p">,</span><span class="n">x32</span><span class="p">,</span><span class="n">y32</span><span class="p">,</span><span class="n">z32</span><span class="p">,</span><span class="n">xyz32</span><span class="p">,</span><span class="n">threeD</span><span class="p">,</span><span class="n">out_f</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">E_IO</span><span class="p">)</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">x64</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; X Coordinates components (64 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">y64</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; Y Coordinates components (64 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">z64</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; Z Coordinates components (64 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">xyz64</span><span class="p">(:,:,:,:)</span> <span class="c">!&lt; Packed coordinates components (64 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">x32</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; X Coordinates components (32 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">y32</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; Y Coordinates components (32 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">z32</span><span class="p">(:,:,:)</span>     <span class="c">!&lt; Z Coordinates components (32 bits).</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span> <span class="k">optional</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">xyz32</span><span class="p">(:,:,:,:)</span> <span class="c">!&lt; Packed coordinates components (32 bits).</span>
    <span class="kt">logical</span><span class="p">,</span>             <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">threeD</span>         <span class="c">!&lt; Flag for checking the rank-dimensions of outputs.</span>
    <span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span>        <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">out_f</span>          <span class="c">!&lt; Output format.</span>
    <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                    <span class="n">E_IO</span>           <span class="c">!&lt; Error traping flag.</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>

    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">threeD</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x64</span><span class="p">))</span> <span class="k">then</span> <span class="c">! non packed, 3D rank array, 64 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-3DA-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-64.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">x64</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">y64</span><span class="p">,</span><span class="n">Z</span><span class="o">=</span><span class="n">z64</span><span class="p">)</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x32</span><span class="p">))</span> <span class="k">then</span> <span class="c">! non packed, 3D rank array, 32 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-3DA-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-32.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">x32</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">y32</span><span class="p">,</span><span class="n">Z</span><span class="o">=</span><span class="n">z32</span><span class="p">)</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">xyz64</span><span class="p">))</span> <span class="k">then</span> <span class="c">! packed, 3D rank array, 64 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-3DAP-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-64.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">XYZ</span><span class="o">=</span><span class="n">xyz64</span><span class="p">)</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">xyz32</span><span class="p">))</span> <span class="k">then</span> <span class="c">! packed, 3D rank array, 32 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-3DAP-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-32.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">XYZ</span><span class="o">=</span><span class="n">xyz32</span><span class="p">)</span>
      <span class="n">endif</span>
    <span class="k">else</span>
<span class="k">      if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x64</span><span class="p">))</span> <span class="k">then</span> <span class="c">! non packed, 1D rank array, 64 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-1DA-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-64.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,&amp;</span>
                           <span class="n">X</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x64</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">Y</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">y64</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">Z</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">z64</span><span class="p">,[</span><span class="n">nn</span><span class="p">]))</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x32</span><span class="p">))</span> <span class="k">then</span> <span class="c">! non packed, 1D rank array, 32 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-1DA-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-32.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,&amp;</span>
                           <span class="n">X</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x32</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">Y</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">y32</span><span class="p">,[</span><span class="n">nn</span><span class="p">]),</span><span class="n">Z</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">z32</span><span class="p">,[</span><span class="n">nn</span><span class="p">]))</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">xyz64</span><span class="p">))</span> <span class="k">then</span> <span class="c">! packed, 1D rank array, 64 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-1DAP-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-64.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">XYZ</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">xyz64</span><span class="p">,[</span><span class="mi">3</span><span class="p">,</span><span class="n">nn</span><span class="p">]))</span>
      <span class="n">elseif</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">xyz32</span><span class="p">))</span> <span class="k">then</span> <span class="c">! packed, 1D rank array, 32 bits data</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">),</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG-1DAP-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_f</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-32.vts&#39;</span><span class="p">,&amp;</span>
                           <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
        <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">XYZ</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">xyz32</span><span class="p">,[</span><span class="mi">3</span><span class="p">,</span><span class="n">nn</span><span class="p">]))</span>
      <span class="n">endif</span>
    <span class="n">endif</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">save_node_variables</span><span class="p">(</span><span class="n">threeD</span><span class="o">=</span><span class="n">threeD</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
    <span class="k">return</span>
    <span class="c">!-------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="n">endfunction</span> <span class="n">save_strg</span>
  <span class="n">endsubroutine</span> <span class="n">test_stress</span>

  <span class="c">!&gt; Subroutine for testing UnstructuredGrid functions.</span>
  <span class="k">subroutine </span><span class="n">test_unst</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>       <span class="n">Nn</span> <span class="o">=</span> <span class="mi">27_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>       <span class="n">Ne</span> <span class="o">=</span> <span class="mi">11_I4P</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I1P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Ne</span><span class="p">)</span><span class="kd">::</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12_I1P</span><span class="p">,</span><span class="mi">12_I1P</span><span class="p">,</span><span class="mi">10_I1P</span><span class="p">,</span><span class="mi">10_I1P</span><span class="p">,</span><span class="mi">7_I1P</span><span class="p">,</span><span class="mi">6_I1P</span><span class="p">,</span><span class="mi">9_I1P</span><span class="p">,</span><span class="mi">5_I1P</span><span class="p">,</span><span class="mi">5_I1P</span><span class="p">,</span><span class="mi">3_I1P</span><span class="p">,</span><span class="mi">1_I1P</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Ne</span><span class="p">)</span><span class="kd">::</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8_I4P</span><span class="p">,</span><span class="mi">16_I4P</span><span class="p">,</span><span class="mi">20_I4P</span><span class="p">,</span><span class="mi">24_I4P</span><span class="p">,</span><span class="mi">30_I4P</span><span class="p">,</span><span class="mi">36_I4P</span><span class="p">,</span><span class="mi">40_I4P</span><span class="p">,</span><span class="mi">43_I4P</span><span class="p">,</span><span class="mi">46_I4P</span><span class="p">,</span><span class="mi">48_I4P</span><span class="p">,</span><span class="mi">49_I4P</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">49</span><span class="p">)</span><span class="kd">::</span> <span class="n">connect</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_X</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_Y</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_Z</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                  <span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing UnstructuredGrid functions. Output file is XML_UNST#.vtu&#39;</span>
  <span class="n">connect</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">4</span> <span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">6</span> <span class="p">,</span><span class="mi">7</span> <span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span> <span class="p">,</span> <span class="p">&amp;</span>
              <span class="mi">1</span> <span class="p">,</span><span class="mi">2</span> <span class="p">,</span><span class="mi">5</span> <span class="p">,</span><span class="mi">4</span> <span class="p">,</span><span class="mi">7</span> <span class="p">,</span><span class="mi">8</span> <span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="p">&amp;</span>
              <span class="mi">6</span> <span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span> <span class="p">,</span><span class="mi">12</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">5</span> <span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span>       <span class="p">&amp;</span>
              <span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span>       <span class="p">&amp;</span>
              <span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span>                <span class="p">&amp;</span>
              <span class="mi">22</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span>                <span class="p">&amp;</span>
              <span class="mi">26</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>                   <span class="p">&amp;</span>
              <span class="mi">24</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">9.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">4.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">5.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">6.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">7.0</span><span class="p">,</span> <span class="p">&amp;</span>
      <span class="mi">1</span><span class="mf">8.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">9.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">4.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">5.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">6.0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_X</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_Y</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_Z</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span>
  <span class="c">! ascii</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST-ascii.vtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;UnstructuredGrid&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_CON_XML</span><span class="p">(</span><span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">connect</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_type</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;opeN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">varX</span><span class="o">=</span><span class="n">v_X</span><span class="p">,</span><span class="n">varY</span><span class="o">=</span><span class="n">v_Y</span><span class="p">,</span><span class="n">varZ</span><span class="o">=</span><span class="n">v_Z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! raw</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST-raw.vtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;UnstructuredGrid&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_CON_XML</span><span class="p">(</span><span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">connect</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_type</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;opeN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">varX</span><span class="o">=</span><span class="n">v_X</span><span class="p">,</span><span class="n">varY</span><span class="o">=</span><span class="n">v_Y</span><span class="p">,</span><span class="n">varZ</span><span class="o">=</span><span class="n">v_Z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! binary</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST-binary.vtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;UnstructuredGrid&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_CON_XML</span><span class="p">(</span><span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">connect</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_type</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;opeN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">varX</span><span class="o">=</span><span class="n">v_X</span><span class="p">,</span><span class="n">varY</span><span class="o">=</span><span class="n">v_Y</span><span class="p">,</span><span class="n">varZ</span><span class="o">=</span><span class="n">v_Z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_unst</span>

  <span class="c">!&gt; Subroutine for testing StructuredGrid functions.</span>
  <span class="k">subroutine </span><span class="n">test_strg</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                       <span class="n">nx1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="mi">9_I4P</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="mi">5_I4P</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="mi">5_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                       <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_R</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                                  <span class="n">E_IO</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                                  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing StructuredGrid functions. Output files is XML_STRG.vts&#39;</span>
  <span class="c">! initializing data</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
        <span class="n">x</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">1._R8P</span>
        <span class="n">y</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">1._R8P</span>
        <span class="n">z</span><span class="p">(</span>  <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mf">1._R8P</span>
        <span class="n">v_R</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">k</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
      <span class="n">enddo</span>
    <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG.vts&#39;</span><span class="p">,</span><span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,&amp;</span>
                     <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;scal_R8&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">v_R</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_strg</span>

  <span class="c">!&gt; Subroutine for testing RectilinearGrid functions.</span>
  <span class="c">!&gt; @note This subroutine also shows the usage of FieldData functions that are useful for saving global auxiliary data, e.g. time,</span>
  <span class="c">!&gt; time step, ecc.</span>
  <span class="k">subroutine </span><span class="n">test_rect</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nx1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="mi">30_I4P</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="mi">20_I4P</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="mi">10_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">x</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">),</span><span class="n">y</span><span class="p">(</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">),</span><span class="n">z</span><span class="p">(</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nn</span><span class="p">)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing RectilinearGrid functions. Output file is XML_RECT#.vtr&#39;</span>
  <span class="c">! arrays initialization</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
   <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
     <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
       <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
       <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">k</span>
     <span class="n">enddo</span>
   <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
    <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">1._R4P</span>
  <span class="n">enddo</span>
  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
    <span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">1._R4P</span>
  <span class="n">enddo</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
    <span class="n">z</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mf">1._R4P</span>
  <span class="n">enddo</span>
  <span class="c">! ascii</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_RECT-ascii.vtr&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;RectilinearGrid&#39;</span><span class="p">,</span> <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mf">0._R8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mi">1_I8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;CYCLE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;cell_value&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! raw</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_RECT-raw.vtr&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;RectilinearGrid&#39;</span><span class="p">,</span> <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mf">0._R8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mi">1_I8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;CYCLE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;cell_value&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! binary</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_RECT-binary.vtr&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;RectilinearGrid&#39;</span><span class="p">,</span> <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mf">0._R8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld</span><span class="o">=</span><span class="mi">1_I8P</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;CYCLE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_FLD_XML</span><span class="p">(</span><span class="n">fld_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;cell_value&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_rect</span>

  <span class="c">!&gt; Subroutine for testing parallel (partitioned) PStructuredGrid functions.</span>
  <span class="c">!&gt; @note Note that the two parts are completely independet.</span>
  <span class="k">subroutine </span><span class="n">test_punst</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>       <span class="n">Nn</span> <span class="o">=</span> <span class="mi">27_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>       <span class="n">Ne</span> <span class="o">=</span> <span class="mi">11_I4P</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R4P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I1P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Ne</span><span class="p">)</span><span class="kd">::</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12_I1P</span><span class="p">,</span><span class="mi">12_I1P</span><span class="p">,</span><span class="mi">10_I1P</span><span class="p">,</span><span class="mi">10_I1P</span><span class="p">,</span><span class="mi">7_I1P</span><span class="p">,</span><span class="mi">6_I1P</span><span class="p">,</span><span class="mi">9_I1P</span><span class="p">,</span><span class="mi">5_I1P</span><span class="p">,</span><span class="mi">5_I1P</span><span class="p">,</span><span class="mi">3_I1P</span><span class="p">,</span><span class="mi">1_I1P</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Ne</span><span class="p">)</span><span class="kd">::</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8_I4P</span><span class="p">,</span><span class="mi">16_I4P</span><span class="p">,</span><span class="mi">20_I4P</span><span class="p">,</span><span class="mi">24_I4P</span><span class="p">,</span><span class="mi">30_I4P</span><span class="p">,</span><span class="mi">36_I4P</span><span class="p">,</span><span class="mi">40_I4P</span><span class="p">,</span><span class="mi">43_I4P</span><span class="p">,</span><span class="mi">46_I4P</span><span class="p">,</span><span class="mi">48_I4P</span><span class="p">,</span><span class="mi">49_I4P</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">49</span><span class="p">)</span><span class="kd">::</span> <span class="n">connect</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_X</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_Y</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nn</span><span class="p">)</span><span class="kd">::</span> <span class="n">v_Z</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                  <span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing parallel (partitioned) PUnstructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Output files are XML_UNST.pvtu, XML_UNST_part0.vtu, XML_UNST_part1.vtu&#39;</span>
  <span class="n">connect</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">4</span> <span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">6</span> <span class="p">,</span><span class="mi">7</span> <span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span> <span class="p">,</span> <span class="p">&amp;</span>
              <span class="mi">1</span> <span class="p">,</span><span class="mi">2</span> <span class="p">,</span><span class="mi">5</span> <span class="p">,</span><span class="mi">4</span> <span class="p">,</span><span class="mi">7</span> <span class="p">,</span><span class="mi">8</span> <span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="p">&amp;</span>
              <span class="mi">6</span> <span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span> <span class="p">,</span><span class="mi">12</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">5</span> <span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span>       <span class="p">&amp;</span>
              <span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span>       <span class="p">&amp;</span>
              <span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span>             <span class="p">&amp;</span>
              <span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span>                <span class="p">&amp;</span>
              <span class="mi">22</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span>                <span class="p">&amp;</span>
              <span class="mi">26</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>                   <span class="p">&amp;</span>
              <span class="mi">24</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">9.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">4.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">5.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">6.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">7.0</span><span class="p">,</span> <span class="p">&amp;</span>
      <span class="mi">1</span><span class="mf">8.0</span><span class="p">,</span><span class="mi">1</span><span class="mf">9.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">4.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">5.0</span><span class="p">,</span><span class="mi">2</span><span class="mf">6.0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_X</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_Y</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
  <span class="n">v_Z</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span>
  <span class="c">! first part</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST_part0.vtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;UnstructuredGrid&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_CON_XML</span><span class="p">(</span><span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">connect</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_type</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;opeN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">varX</span><span class="o">=</span><span class="n">v_X</span><span class="p">,</span><span class="n">varY</span><span class="o">=</span><span class="n">v_Y</span><span class="p">,</span><span class="n">varZ</span><span class="o">=</span><span class="n">v_Z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! second part</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="mf">0._R4P</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST_part1.vtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;UnstructuredGrid&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_CON_XML</span><span class="p">(</span><span class="n">NC</span> <span class="o">=</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">connect</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_type</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;opeN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">varX</span><span class="o">=</span><span class="n">v_X</span><span class="p">,</span><span class="n">varY</span><span class="o">=</span><span class="n">v_Y</span><span class="p">,</span><span class="n">varZ</span><span class="o">=</span><span class="n">v_Z</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;CLOSE&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="c">! pvtu</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_INI_XML</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_UNST.pvtu&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;PUnstructuredGrid&#39;</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Float32&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_UNST_part0.vtu&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_UNST_part1.vtu&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;OPEN&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_VAR_XML</span><span class="p">(</span><span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;scalars&#39;</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_VAR_XML</span><span class="p">(</span><span class="n">Nc</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Int32&#39;</span> <span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_punst</span>

  <span class="c">!&gt; Subroutine for testing parallel (partitioned) PStructuredGrid functions.</span>
  <span class="c">!&gt; @note The mesh is a simple prism partitioned into two pieces along x direction at ordinate i=nx2_p(1).</span>
  <span class="c">!&gt; @code</span>
  <span class="c">!&gt; y ^</span>
  <span class="c">!&gt;   |               ny2 +-----------------+--------------+</span>
  <span class="c">!&gt;   |                   |                 |              |</span>
  <span class="c">!&gt;   |                   |                 |              |</span>
  <span class="c">!&gt;   |                   |                 |              |</span>
  <span class="c">!&gt;   |                   |                 |              |</span>
  <span class="c">!&gt;   o--------&gt;      ny1 +-----------------+--------------+</span>
  <span class="c">!&gt;            x         nx1               i=nx2_p(1)     nx2</span>
  <span class="c">!&gt; @endcode</span>
  <span class="k">subroutine </span><span class="n">test_pstrg</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nx1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="mi">9_I4P</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="mi">5_I4P</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="mi">5_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nx1_p</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="n">nx1</span><span class="p">,</span><span class="mi">4_I4P</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nx2_p</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="mi">4_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="p">]</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nn</span>       <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span>     <span class="o">-</span><span class="n">nx1</span>     <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nn_p</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="p">[(</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">nx1</span>     <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span>
                                                                <span class="p">(</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">v</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                                     <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">),</span><span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing parallel (partitioned) PStructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Output files are XML_STRG.pvts, XML_STRG_part0.vts, XML_STRG_part1.vts&#39;</span>
  <span class="c">! arrays initialization</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
   <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
     <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
       <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">k</span>
     <span class="n">enddo</span>
   <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="k">do </span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="c">! loop over pieces</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_STRG_part&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                       <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span> <span class="n">nx1</span><span class="o">=</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">NN</span><span class="o">=</span><span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="p">&amp;</span>
                       <span class="n">X</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),:,:),(</span><span class="o">/</span><span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">)),</span>                                     <span class="p">&amp;</span>
                       <span class="n">Y</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),:,:),(</span><span class="o">/</span><span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">)),</span>                                     <span class="p">&amp;</span>
                       <span class="n">Z</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),:,:),(</span><span class="o">/</span><span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">)))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;node_value&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">nx1_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span><span class="n">nx2_p</span><span class="p">(</span><span class="n">p</span><span class="p">),:,:),(</span><span class="o">/</span><span class="n">nn_p</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">)))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="n">enddo</span>
  <span class="c">! pvts</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_INI_XML</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_STRG.pvts&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;PStructuredGrid&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                      <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span>      <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span>      <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span>      <span class="n">nx2</span><span class="o">=</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_STRG_part0.vts&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2_p</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_STRG_part1.vts&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_VAR_XML</span><span class="p">(</span><span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;node_value&#39;</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Int32&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_pstrg</span>

  <span class="c">!&gt; Subroutine for testing multi-blocks VTM functions. There are 4 subset of data organized into 2 blocks. All the subsets are</span>
  <span class="c">!&gt; simple StructuredGrid prisms shifted along x direction.</span>
  <span class="k">subroutine </span><span class="n">test_vtm</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nx1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="mi">9_I4P</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="mi">5_I4P</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="mi">0_I4P</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="mi">5_I4P</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>                          <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span>    <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span><span class="kd">::</span> <span class="n">v</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>                                     <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">mf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">),</span><span class="n">E_IO</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing multi-blocks VTM functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Output files are XML_M-STRG.vtm, XML_M-STRG_part.0.vts, XML_M-STRG_part.1.vts&#39;</span>
  <span class="c">! arrays initialization</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
   <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
     <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
       <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mf">1._R8P</span>
       <span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1_I4P</span>
     <span class="n">enddo</span>
   <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="c">! vts</span>
  <span class="k">do </span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span> <span class="c">! loop over blocks</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_M-STRG_part.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                       <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span> <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">nx2</span><span class="o">*</span><span class="mf">1._R8P</span>
      <span class="n">v</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">endif</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span> <span class="n">nx2</span><span class="o">=</span><span class="n">nx2</span><span class="p">,</span> <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span> <span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span> <span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span> <span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span> <span class="p">&amp;</span>
                       <span class="n">X</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,:,:),(</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="p">)),</span>                                     <span class="p">&amp;</span>
                       <span class="n">Y</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,:,:),(</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="p">)),</span>                                     <span class="p">&amp;</span>
                       <span class="n">Z</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,:,:),(</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="p">)))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">NC_NN</span> <span class="o">=</span> <span class="n">nn</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;node_value&#39;</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,:,:),(</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="p">)))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">var_location</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">var_block_action</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="n">enddo</span>
  <span class="c">! vtm</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_INI_XML</span><span class="p">(</span><span class="s1">&#39;XML_M-STRG.vtm&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_BLK_XML</span><span class="p">(</span><span class="n">block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_WRF_XML</span><span class="p">(</span><span class="n">flist</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="p">(</span><span class="s1">&#39;XML_M-STRG_part.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">))</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_BLK_XML</span><span class="p">(</span><span class="n">block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_BLK_XML</span><span class="p">(</span><span class="n">block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_WRF_XML</span><span class="p">(</span><span class="n">flist</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="p">(</span><span class="s1">&#39;XML_M-STRG_part.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">))</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_BLK_XML</span><span class="p">(</span><span class="n">block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTM_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_vtm</span>

<span class="cp">#ifdef OPENMP</span>
  <span class="c">!&gt; Subroutine for testing the libray in an OpenMP parallel framework. It is used for testing thread-safe capability and the</span>
  <span class="c">!&gt; library speedup into OpenMP parallel framework. The output is a parallel (partitioned) PStructuredGrid file.</span>
  <span class="c">!&gt; @note The whole grid is composed of blocks of 32x32x32 structured mesh. The total number of blocks/files, Nf_tot, is passed as</span>
  <span class="c">!&gt; argument. The whole grid is built up composing the blocks along the X axis with a regular shift as following:</span>
  <span class="c">!&gt; @code</span>
  <span class="c">!&gt; y ^</span>
  <span class="c">!&gt;   |               ny2 +------------+------------+------------+------///////////-----+</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   o--------&gt;      ny1 +------------+------------+------------+------///////////-----+</span>
  <span class="c">!&gt;            x         nx1          nx2    2*(nx2-nx+1)  3*(nx2-nx+1)          Nf_tot*(nx2-nx+1)</span>
  <span class="c">!&gt; @endcode</span>
  <span class="c">!&gt; @note When the total number of blocks/files, Nf_tot, is not an integral of the number of threads used, Nths, the last</span>
  <span class="c">!&gt; thread saves its own files (Nf_tot/Nths) plus the remainder blocks/files (mod(Nf_tot,Nths)). As a consequence the last</span>
  <span class="c">!&gt; thread could has different elapsed time and it could degrade the speedup. Therefore the subroutine prints to stdout the</span>
  <span class="c">!&gt; maximum and minimum elapsed time among the threads as well the average elapsed time in order to facilitate the assessing</span>
  <span class="c">!&gt; of the parallel scalability.</span>
  <span class="c">!&gt; @note It is important to note that the output files initialization and finalization must be done outside the parallel ambient.</span>
  <span class="c">!&gt; @note The array containing the files indexes could be shared among threads, but the counter of this array (&#39;p&#39; in this example)</span>
  <span class="c">!&gt; must be private.</span>
  <span class="k">subroutine </span><span class="n">test_openmp</span><span class="p">(</span><span class="n">Nf_tot</span><span class="p">)</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">USE </span><span class="n">omp_lib</span> <span class="c">! OpenMP runtime library.</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span>  <span class="n">Nf_tot</span>                                             <span class="c">!&lt; Total number of files saved.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">nx1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in x direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">nx2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in x direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">ny1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in y direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">ny2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in y direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">nz1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in z direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">nz2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in z direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span>   <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span> <span class="c">!&lt; Whole grid extents.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>                 <span class="n">x</span><span class="p">(</span> <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                        <span class="c">!&lt; Coordinates in x direction.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>                 <span class="n">y</span><span class="p">(</span> <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                        <span class="c">!&lt; Coordinates in y direction.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>                 <span class="n">z</span><span class="p">(</span> <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                        <span class="c">!&lt; Coordinates in z direction.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>                 <span class="n">xf</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                        <span class="c">!&lt; Coordinates in x shifted by file offset.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">allocatable</span><span class="kd">::</span> <span class="n">v</span><span class="p">(:,:,:,:)</span>                                         <span class="c">!&lt; Variable associated to nodes.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>              <span class="n">mf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nf_tot</span><span class="p">)</span>                                       <span class="c">!&lt; File indexes.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>              <span class="n">Nths</span>                                               <span class="c">!&lt; Number of concurrent threads.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>              <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">nxf</span><span class="p">,</span><span class="n">th</span>                                     <span class="c">!&lt; Counters.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>              <span class="n">E_IO</span>                                               <span class="c">!&lt; Error trapping flag.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>                 <span class="n">vtk_start</span><span class="p">,</span><span class="n">vtk_stop</span>                                 <span class="c">!&lt; Timing variables.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">),</span> <span class="k">allocatable</span><span class="kd">::</span>    <span class="n">t</span><span class="p">(:)</span>                                               <span class="c">!&lt; Timing variables.</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="c">!$OMP PARALLEL</span>
  <span class="n">Nths</span> <span class="o">=</span> <span class="n">OMP_GET_NUM_THREADS</span><span class="p">()</span>
  <span class="c">!$OMP END PARALLEL</span>
  <span class="k">allocate</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">Nths</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">))</span>
  <span class="k">allocate</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">Nths</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing OpenMP parallel framework&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; The test uses &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">Nf_tot</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; vts files of &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">nn</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; grid nodes as&#39;</span><span class="o">//</span><span class="p">&amp;</span>
                     <span class="s1">&#39; benchmark&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Number of files saved by each thread is &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">Nf_tot</span><span class="o">/</span><span class="n">Nths</span><span class="p">))</span>
  <span class="c">! arrays initialization</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
        <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">nx1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
        <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">ny1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
        <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">nz1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
        <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Nths</span><span class="o">-</span><span class="mi">1</span>
          <span class="n">v</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">enddo</span>
      <span class="n">enddo</span>
    <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="c">! opening files outside OpenMP framework</span>
  <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf_tot</span>
    <span class="n">nxf</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_OPENMP_f&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">strz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                       <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,&amp;</span>
                       <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
  <span class="n">enddo</span>
  <span class="c">! saving files</span>
  <span class="n">t</span><span class="o">=</span> <span class="mf">0._R8P</span>
  <span class="c">!$OMP PARALLEL                                     &amp;</span>
  <span class="c">!$OMP DEFAULT(NONE)                                &amp;</span>
  <span class="c">!$OMP PRIVATE(f,E_IO,th,nxf,vtk_start,vtk_stop,xf) &amp;</span>
  <span class="c">!$OMP SHARED(mf,x,y,z,v,Nf_tot,t)</span>
  <span class="n">th</span> <span class="o">=</span> <span class="n">OMP_GET_THREAD_NUM</span><span class="p">()</span>
  <span class="c">!$OMP DO</span>
  <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf_tot</span> <span class="c">! loop over files</span>
    <span class="n">nxf</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="kt">real</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mi">1_I4P</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
    <span class="n">vtk_start</span> <span class="o">=</span> <span class="n">OMP_GET_WTIME</span><span class="p">()</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">xf</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;node_value&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">v</span><span class="p">(</span><span class="n">th</span><span class="p">,:,:,:))</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">mf</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="n">vtk_stop</span> <span class="o">=</span> <span class="n">OMP_GET_WTIME</span><span class="p">()</span>
    <span class="n">t</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">+</span> <span class="n">vtk_stop</span><span class="o">-</span><span class="n">vtk_start</span>
  <span class="n">enddo</span>
  <span class="c">!$OMP END PARALLEL</span>
  <span class="c">! closing files outside OpenMP framework</span>
  <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf_tot</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
  <span class="n">enddo</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Maximum elapsed time of single thread &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="nb">maxval</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Minimum elapsed time of single thread &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Average elapsed time &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">Nths</span><span class="p">)))</span>
  <span class="c">! saving the composite .pvts file</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_INI_XML</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_OPENMP.pvts&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;PStructuredGrid&#39;</span><span class="p">,&amp;</span>
                      <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Nf_tot</span><span class="o">-</span><span class="p">(</span><span class="n">Nf_tot</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
  <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf_tot</span>
    <span class="n">nxf</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,&amp;</span>
                        <span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_OPENMP_f&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">strz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">)</span>
  <span class="n">enddo</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_VAR_XML</span><span class="p">(</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;node_value&#39;</span><span class="p">,</span><span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Int32&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
  <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_END_XML</span><span class="p">()</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_openmp</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef MPI2</span>
  <span class="c">!&gt; Subroutine for testing the library in an MPI parallel framework. It is used for testing the process-safe capability and the</span>
  <span class="c">!&gt; library speedup into MPI parallel framework.  The output is a parallel (partitioned) PStructuredGrid file.</span>
  <span class="c">!&gt; @note The whole grid is composed of blocks of 32x32x32 structured mesh. The total number of blocks/files, Nf_tot, is passed as</span>
  <span class="c">!&gt; argument. The whole grid is built up composing the blocks along the X axis with a regular shift as following:</span>
  <span class="c">!&gt; @code</span>
  <span class="c">!&gt; y ^</span>
  <span class="c">!&gt;   |               ny2 +------------+------------+------------+------///////////-----+</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   |                   |            |            |            |                      |</span>
  <span class="c">!&gt;   o--------&gt;      ny1 +------------+------------+------------+------///////////-----+</span>
  <span class="c">!&gt;            x         nx1          nx2    2*(nx2-nx+1)  3*(nx2-nx+1)          Nf_tot*(nx2-nx+1)</span>
  <span class="c">!&gt; @endcode</span>
  <span class="c">!&gt; @note When the total number of blocks/files, Nf_tot, is not an integral of the number of processes used, nproc, the last</span>
  <span class="c">!&gt; process saves its own files (Nf_tot/nproc) plus the remainder blocks/files (mod(Nf_tot,nproc)). As a consequence the last</span>
  <span class="c">!&gt; process could has different elapsed time and it could degrade the speedup. Therefore the subroutine prints to stdout the</span>
  <span class="c">!&gt; maximum and minimum elapsed time among the processes as well the average elapsed time in order to facilitate the assessing</span>
  <span class="c">!&gt; of the parallel scalability.</span>
  <span class="k">subroutine </span><span class="n">test_mpi</span><span class="p">(</span><span class="n">Nf_tot</span><span class="p">)</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">USE </span><span class="n">MPI</span> <span class="c">! MPI runtime library.</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span><span class="n">Nf_tot</span>                                             <span class="c">!&lt; Total number of files saved.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nx1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in x direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nx2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in x direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">ny1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in y direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">ny2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in y direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nz1</span><span class="o">=</span><span class="mi">1_I4P</span>                                          <span class="c">!&lt; First node in z direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nz2</span><span class="o">=</span><span class="mi">32_I4P</span>                                         <span class="c">!&lt; Last node in z direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">),</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">nn</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="o">+</span><span class="mi">1_I4P</span><span class="p">)</span> <span class="c">!&lt; Whole grid extents.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">x</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                         <span class="c">!&lt; Coordinates in x direction.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">y</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                         <span class="c">!&lt; Coordinates in y direction.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">z</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                         <span class="c">!&lt; Coordinates in z direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">v</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                         <span class="c">!&lt; Variable associated to nodes.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">xf</span><span class="p">(</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">,</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="p">:</span><span class="n">nz2</span><span class="p">)</span>                        <span class="c">!&lt; Coordinates in x shifted by file offset direction.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">foffset</span><span class="p">,</span><span class="n">nxf</span>                                <span class="c">!&lt; Counters.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">myrank</span>                                             <span class="c">!&lt; Rank of current process.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">Nf</span>                                                 <span class="c">!&lt; Number of files saved by the current process.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">nproc</span>                                              <span class="c">!&lt; Number of concurrent processes.</span>
  <span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span>            <span class="n">E_IO</span>                                               <span class="c">!&lt; Error trapping flag.</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">R8P</span><span class="p">)</span><span class="kd">::</span>               <span class="n">vtk_start</span><span class="p">,</span><span class="n">vtk_stop</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">tmax</span><span class="p">,</span><span class="n">tmin</span><span class="p">,</span><span class="n">tmean</span>               <span class="c">!&lt; Timing variables.</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="c">! initializing parallel environments</span>
  <span class="k">call </span><span class="n">MPI_INIT</span><span class="p">(</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">call </span><span class="n">MPI_COMM_RANK</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="n">myrank</span><span class="p">,</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">call </span><span class="n">MPI_COMM_SIZE</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="n">nproc</span><span class="p">,</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="c">! computing the number of files to be saved</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">myrank</span><span class="o">==</span><span class="n">nproc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
    <span class="c">! the last process must save also the rest of the files if Nf_tot is not an integral of nproc</span>
    <span class="n">Nf</span> <span class="o">=</span> <span class="n">Nf_tot</span><span class="o">/</span><span class="n">nproc</span> <span class="o">+</span> <span class="nb">mod</span><span class="p">(</span><span class="n">Nf_tot</span><span class="p">,</span><span class="n">nproc</span><span class="p">)</span>
  <span class="k">else</span>
<span class="k">    </span><span class="n">Nf</span> <span class="o">=</span> <span class="n">Nf_tot</span><span class="o">/</span><span class="n">nproc</span>
  <span class="n">endif</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">myrank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">    write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Testing MPI parallel framework&#39;</span>
    <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; The test uses &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">Nf_tot</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; vts files of &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">nn</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; grid nodes as&#39;</span><span class="o">//</span><span class="p">&amp;</span>
                       <span class="s1">&#39; benchmark&#39;</span>
    <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Number of files saved by processes other than the last is &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">Nf</span><span class="p">))</span>
  <span class="n">elseif</span> <span class="p">(</span><span class="n">myrank</span><span class="o">==</span><span class="n">nproc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">    write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Number of files saved by last process is &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">(.</span><span class="n">true</span><span class="p">.,</span><span class="n">Nf</span><span class="p">))</span>
  <span class="n">endif</span>
  <span class="c">! arrays initialization</span>
  <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span>
      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span>
        <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">nx1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
        <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">ny1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">ny2</span><span class="o">-</span><span class="n">ny1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
        <span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">nz1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">nz2</span><span class="o">-</span><span class="n">nz1</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
      <span class="n">enddo</span>
    <span class="n">enddo</span>
  <span class="n">enddo</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">myrank</span>
  <span class="c">! saving files</span>
  <span class="n">t</span><span class="o">=</span> <span class="mf">0._R8P</span>
  <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf</span> <span class="c">! loop over files of current process</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">myrank</span><span class="o">&lt;</span><span class="n">nproc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      </span><span class="n">foffset</span> <span class="o">=</span> <span class="n">f</span><span class="o">+</span><span class="n">myrank</span><span class="o">*</span><span class="n">Nf</span>
    <span class="k">else</span>
<span class="k">      </span><span class="n">foffset</span> <span class="o">=</span> <span class="n">f</span><span class="o">+</span><span class="n">myrank</span><span class="o">*</span><span class="p">(</span><span class="n">Nf</span><span class="o">-</span><span class="nb">mod</span><span class="p">(</span><span class="n">Nf_tot</span><span class="p">,</span><span class="n">nproc</span><span class="p">))</span>
    <span class="n">endif</span>
    <span class="n">nxf</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">foffset</span><span class="o">-</span><span class="p">(</span><span class="n">foffset</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">vtk_start</span> <span class="o">=</span> <span class="n">MPI_Wtime</span><span class="p">()</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_INI_XML</span><span class="p">(</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;XML_MPI_f&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">strz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">foffset</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                       <span class="n">mesh_topology</span><span class="o">=</span><span class="s1">&#39;StructuredGrid&#39;</span><span class="p">,</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,&amp;</span>
                       <span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">)</span>
    <span class="c">! updating x coordinates of current process/file</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="kt">real</span><span class="p">(</span><span class="n">foffset</span><span class="o">-</span><span class="mi">1_I4P</span><span class="p">,</span><span class="n">R8P</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">xf</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">Z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_VAR_XML</span><span class="p">(</span><span class="n">NC_NN</span><span class="o">=</span><span class="n">nn</span><span class="p">,</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;node_value&#39;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_GEO_XML</span><span class="p">()</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">VTK_END_XML</span><span class="p">()</span>
    <span class="n">vtk_stop</span> <span class="o">=</span> <span class="n">MPI_Wtime</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">vtk_stop</span><span class="o">-</span><span class="n">vtk_start</span>
  <span class="n">enddo</span>
  <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tmax</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_REAL8</span><span class="p">,</span><span class="n">MPI_MAX</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tmin</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_REAL8</span><span class="p">,</span><span class="n">MPI_MIN</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">call </span><span class="n">MPI_REDUCE</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tmean</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_REAL8</span><span class="p">,</span><span class="n">MPI_SUM</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">myrank</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">    </span><span class="n">tmean</span> <span class="o">=</span> <span class="n">tmean</span><span class="o">/</span><span class="n">nproc</span>
    <span class="c">! first process prints the elapsed time to stdout</span>
    <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Maximum elapsed time of single process &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="n">tmax</span><span class="p">)))</span>
    <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Minimum elapsed time of single process &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="n">tmin</span><span class="p">)))</span>
    <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Average elapsed time &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="s1">&#39;(F9.4)&#39;</span><span class="p">,</span><span class="n">tmean</span><span class="p">)))</span>
    <span class="c">! first process saves also the composite .pvts file</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_INI_XML</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;XML_MPI.pvts&#39;</span><span class="p">,</span> <span class="n">mesh_topology</span> <span class="o">=</span> <span class="s1">&#39;PStructuredGrid&#39;</span><span class="p">,&amp;</span>
                        <span class="n">nx1</span><span class="o">=</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Nf_tot</span><span class="o">-</span><span class="p">(</span><span class="n">Nf_tot</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,</span><span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="k">do </span><span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf_tot</span>
      <span class="n">nxf</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_GEO_XML</span><span class="p">(</span><span class="n">nx1</span><span class="o">=</span><span class="n">nxf</span><span class="o">-</span><span class="p">(</span><span class="n">nx2</span><span class="o">-</span><span class="n">nx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nx2</span><span class="o">=</span><span class="n">nxf</span><span class="p">,</span><span class="n">ny1</span><span class="o">=</span><span class="n">ny1</span><span class="p">,</span><span class="n">ny2</span><span class="o">=</span><span class="n">ny2</span><span class="p">,</span><span class="n">nz1</span><span class="o">=</span><span class="n">nz1</span><span class="p">,</span><span class="n">nz2</span><span class="o">=</span><span class="n">nz2</span><span class="p">,&amp;</span>
                          <span class="n">source</span><span class="o">=</span><span class="s1">&#39;XML_MPI_f&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">strz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">f</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;.vts&#39;</span><span class="p">)</span>
    <span class="n">enddo</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_VAR_XML</span><span class="p">(</span><span class="n">varname</span><span class="o">=</span><span class="s1">&#39;node_value&#39;</span><span class="p">,</span><span class="n">tp</span><span class="o">=</span><span class="s1">&#39;Int32&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_DAT_XML</span><span class="p">(</span><span class="n">var_location</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="n">var_block_action</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">E_IO</span> <span class="o">=</span> <span class="n">PVTK_END_XML</span><span class="p">()</span>
  <span class="n">endif</span>
  <span class="c">! finalizing parallel environments</span>
  <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">E_IO</span><span class="p">)</span>
  <span class="k">return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">test_mpi</span>
<span class="cp">#endif</span>
  <span class="c">!&gt; @}</span>
<span class="n">endmodule</span> <span class="n">Lib_Testers</span>

<span class="k">program </span><span class="n">Test_Driver</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="c">!&lt; Testing program for Lib_VTK_IO, a pure Fortran (2003+) library to write and read data conforming the VTK standard</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;### Usage</span>
<span class="c">!&lt; For printing help message for usage run it without command line arguments</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing UnstructuredGrid functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -unst</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing StructuredGrid functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -strg</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing RectilinearGrid functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -rect</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing parallel (partitioned) PUnstructuredGrid functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -punst</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing parallel (partitioned) PStructuredGrid functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -pstrg</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing multi-blocks VTM functions</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -vtm</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing thread-safe capability into an OpenMP parallel framework</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -openmp</span>
<span class="c">!&lt;```</span>
<span class="c">!&lt;</span>
<span class="c">!&lt;#### Testing process-safe capability into a MPI parallel framework</span>
<span class="c">!&lt;```bash</span>
<span class="c">!&lt; ./Test_Driver -mpi</span>
<span class="c">!&lt;```</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">USE </span><span class="n">IR_Precision</span>
<span class="k">USE </span><span class="n">Lib_Testers</span>
<span class="k">USE</span><span class="p">,</span> <span class="k">intrinsic</span><span class="kd">::</span> <span class="n">ISO_FORTRAN_ENV</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">stdout</span><span class="o">=&gt;</span><span class="n">OUTPUT_UNIT</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=&gt;</span><span class="n">ERROR_UNIT</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>

<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">implicit none</span>
<span class="kt">integer</span><span class="p">(</span><span class="n">I4P</span><span class="p">)</span><span class="kd">::</span> <span class="n">Nca</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!&lt;  Number of command line arguments.</span>
<span class="kt">character</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="kd">::</span> <span class="n">cas</span>     <span class="c">!&lt;  Command line argument switch.</span>
<span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span> <span class="n">nF</span>     <span class="c">!&lt;  Number of files for MPI and OpenMP benchmarks.</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>

<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="n">nF</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">Nca</span> <span class="o">=</span> <span class="nb">command_argument_count</span><span class="p">()</span>
<span class="k">if</span> <span class="p">(</span><span class="n">Nca</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">  call </span><span class="n">print_usage</span>
<span class="n">endif</span>
<span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cas</span><span class="p">)</span>
<span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">cas</span><span class="p">))</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-unst&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_unst</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-strg&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_strg</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-rect&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_rect</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-punst&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_punst</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-pstrg&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_pstrg</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-vtm&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_vtm</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-openmp&#39;</span><span class="p">)</span>
<span class="cp">#ifndef OPENMP</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; The code has not been compiled with OpenMP directives... nothing to test&#39;</span>
  <span class="k">stop</span>
<span class="cp">#else</span>
  <span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nF</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_openmp</span><span class="p">(</span><span class="n">Nf_tot</span><span class="o">=</span><span class="n">cton</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">nF</span><span class="p">),</span><span class="n">I4P</span><span class="p">))</span>
<span class="cp">#endif</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-mpi&#39;</span><span class="p">)</span>
<span class="cp">#ifndef MPI2</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; The code has not been compiled with MPI library... nothing to test&#39;</span>
  <span class="k">stop</span>
<span class="cp">#else</span>
  <span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nF</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_mpi</span><span class="p">(</span><span class="n">Nf_tot</span><span class="o">=</span><span class="n">cton</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">nF</span><span class="p">),</span><span class="n">I4P</span><span class="p">))</span>
<span class="cp">#endif</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-all&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_rect</span>
  <span class="k">call </span><span class="n">test_unst</span>
  <span class="k">call </span><span class="n">test_strg</span>
  <span class="k">call </span><span class="n">test_punst</span>
  <span class="k">call </span><span class="n">test_pstrg</span>
  <span class="k">call </span><span class="n">test_vtm</span>
<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-stress&#39;</span><span class="p">)</span>
  <span class="k">call </span><span class="n">test_stress</span>
<span class="k">case </span><span class="n">default</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Switch &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">cas</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; unknown&#39;</span>
  <span class="k">call </span><span class="n">print_usage</span>
<span class="n">endselect</span>
<span class="k">stop</span>
<span class="c">!-----------------------------------------------------------------------------------------------------------------------------------</span>
<span class="k">contains</span>
  <span class="c">!&gt; Subroutine for printing usage help message to stdout.</span>
  <span class="k">subroutine </span><span class="n">print_usage</span><span class="p">()</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">implicit none</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>

  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Test_Driver: a &quot;driver&quot; program for testing Lib_VTK_IO functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Usage:&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;   Test_Driver [-switch]&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = unst   =&gt; testing UnstructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = strg   =&gt; testing StructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = rect   =&gt; testing RectilinearGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = punst  =&gt; testing parallel (partitioned) PUnstructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = pstrg  =&gt; testing parallel (partitioned) StructuredGrid functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = vtm    =&gt; testing multi-block XML functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = all    =&gt; testing all above functions&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = openmp =&gt; testing functions in parallel OpenMP framework&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = mpi    =&gt; testing functions in parallel MPI    framework&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;     switch = stress =&gt; testing functions of any kind/rank producing many files&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; Examples:&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;   Test_Driver -pstrg&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;   Test_Driver -vtm&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39;   Test_Driver -openmp&#39;</span>
  <span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span><span class="s1">&#39; If switch is not passed (or is unknown) this help message is printed to stdout&#39;</span>
  <span class="k">stop</span>
<span class="k">  return</span>
  <span class="c">!---------------------------------------------------------------------------------------------------------------------------------</span>
  <span class="n">endsubroutine</span> <span class="n">print_usage</span>
<span class="n">endprogram</span> <span class="n">Test_Driver</span>
</pre></div>

    </div>
  </div>

    <hr>
    <footer>
        <div class="row">
        <div class="col-md-6">&copy; 2015 Lib_VTK_IO was written by Stefano Zaghi. </div>
        <div class="col-md-6"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a>.</span></div>
        </div>
        <br>
    </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>